version: '2'

services:
  # The frontend
  gochat-front:
    image: abiosoft/caddy:latest
    restart: unless-stopped
    ports:
    - 4690:4690
    volumes:
    - ./front/Caddyfile:/etc/Caddyfile:ro
    - ./front:/srv:ro
    mem_limit: 20000000
    memswap_limit: 0
    networks:
    - dev

  # Our backend
  gochat:
    build: ./main
    restart: unless-stopped
    ulimits:
      nofile:
        soft: 8096
        hard: 16192
    environment:
    - GOMAXPROC=4
    command:
    - -listen-on=0.0.0.0:80
    - -max-msg-size=1024
    - -log-level=warn
    ports:
    - 4691:80
    # Let's cap the RAM to 2Gi for our load tests
    mem_limit: 2000000000
    memswap_limit: 0
    networks:
    - dev

networks:
  dev:
    driver: bridge
